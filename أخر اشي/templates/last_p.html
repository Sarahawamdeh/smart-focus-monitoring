<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yarmouk University â€” Lecture Report</title>
    <style>
        :root {
            --y-green: #0b6b3a;
            --muted: #6b7280;
            --surface: #ffffff;
            --bg: #f3f5f7;
        }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Poppins', Inter, sans-serif; background: var(--bg); color: #111827; }
        .app { display: grid; grid-template-columns: 260px 1fr; min-height: 100vh; }
        
        /* ======= SIDEBAR ======= */
        .sidebar { background: var(--y-green); color: white; padding: 28px 20px; display: flex; flex-direction: column; gap: 18px; }
        .brand { display: flex; gap: 12px; align-items: center; }
        .logo { width: 44px; height: 44px; border-radius: 8px; background: white; color: var(--y-green); display: flex; align-items: center; justify-content: center; font-weight: 700; }
        nav { margin-top: 12px; display: flex; flex-direction: column; gap: 8px; }
        .nav-item { padding: 10px 12px; border-radius: 8px; color: rgba(255, 255, 255, 0.95); text-decoration: none; display: flex; gap: 12px; transition: 0.3s; }
        .nav-item:hover { background: rgba(255, 255, 255, 0.1); }
        
        .main { padding: 28px; }
        header.top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; }
        
        /* ======= GRID LAYOUT ======= */
        .grid { display: grid; grid-template-columns: 1fr 420px; gap: 18px; align-items: start; }
        .left-col { display: grid; gap: 18px; }
        .card { background: var(--surface); border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; }
        
        .focus-big { font-size: 48px; color: var(--y-green); font-weight: 800; line-height: 1; margin: 10px 0; }
        .sub { color: var(--muted); font-size: 13px; font-weight: 500; }
        
        /* ======= STUDENT LIST ======= */
        .students-list { display: flex; flex-direction: column; gap: 10px; }
        .student { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-radius: 10px; background: #f9fafb; border: 1px solid #f1f5f9; }
        .student .meta { display: flex; gap: 12px; align-items: center; }
        .avatar { width: 38px; height: 38px; border-radius: 50%; background: #e6eef0; display: flex; align-items: center; justify-content: center; color: var(--y-green); font-weight: 700; font-size: 14px; }
        
        /* ======= BUTTONS ======= */
        .btn { background: var(--y-green); color: white; border: none; padding: 12px 14px; border-radius: 8px; cursor: pointer; font-weight: 600; width: 100%; margin-top: 8px; transition: 0.2s; text-align: center; display: inline-block; text-decoration: none; }
        .btn:hover { background: #08542d; transform: translateY(-1px); }

        .badge { font-weight: 700; padding: 4px 10px; border-radius: 6px; font-size: 14px; }
        .high { color: #065f46; background: #ecfdf5; border: 1px solid #a7f3d0; }
        .mid { color: #92400e; background: #fffbeb; border: 1px solid #fde68a; }
        .low { color: #991b1b; background: #fef2f2; border: 1px solid #fecaca; }

        @media (max-width: 900px) {
            .app { grid-template-columns: 1fr; }
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="app">
    <aside class="sidebar">
        <div class="brand">
            <div class="logo">YU</div>
            <div>
                <div style="font-size:13px; font-weight:600;">Yarmouk University</div>
                <div style="font-size:11px; opacity:0.8">Smart Focus System</div>
            </div>
        </div>
        <nav>
            <a class="nav-item" href="{{ url_for('history', course_id=report.course_id) }}">Sessions History</a>
            <a class="nav-item" href="{{ url_for('logout') }}">Logout</a>
        </nav>
        <div style="margin-top:auto; font-size:11px; opacity:0.7">Â© 2025 Yarmouk University. All rights reserved.</div>
    </aside>

    <main class="main">
        <header class="top">
            <div>
                <h1 style="margin:0; font-size: 24px;">Lecture Summary Report</h1>
                <div class="sub">Final data collected from the monitoring session</div>
            </div>
        </header>

        <section class="grid">
            <div class="left-col">
                <div class="card">
                    <div class="sub">Average Class Focus Score</div>
                    <div class="focus-big">{{ report.avg_focus }}%</div>
                    <div class="sub" style="margin-top:6px; color: #4b5563;">
                        <strong>Course:</strong> {{ report.c_code }} â€” {{ report.c_name }}
                    </div>
                </div>

                <div class="card">
                    <div class="sub" style="margin-bottom: 15px; font-weight: 600;">Student Breakdown</div>
                    <div class="students-list">
                        {% for s in students %}
                        <div class="student">
                            <div class="meta">
                                <div class="avatar">{{ loop.index }}</div>
                                <div><div style="font-weight:700; color: #374151;">{{ s.student_name }}</div></div>
                            </div>
                            <div class="badge {% if s.focus >= 70 %}high{% elif s.focus >= 40 %}mid{% else %}low{% endif %}">
                                {{ s.focus }}%
                            </div>
                        </div>
                        {% else %}
                        <div style="text-align: center; padding: 20px;">
                            <p class="sub">No individual student data was recorded in this session.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="right-col">
                <div class="card">
                    <div class="sub" style="font-weight: 600;">Session Information</div>
                    <div style="font-weight:700; margin: 15px 0; color: #111827;">
                         Date: <span style="font-weight:400">{{ report.created_at[:16] }}</span>
                    </div>
                    <div class="sub" style="margin-bottom: 5px;">Section: <strong>{{ report.section }}</strong></div>
                    <div class="sub">Duration: <strong>{{ report.duration }}</strong></div>
                    
                    <hr style="border:0; border-top:1px solid #f1f5f9; margin: 20px 0;">
                    
                    <button class="btn" onclick="downloadReport()">ðŸ“¥ Download CSV Report</button>
                </div>
            </div>
        </section>
    </main>
</div>

<script>
    const reportData = {
        avg: "{{ report.avg_focus }}",
        name: "{{ report.c_name }}",
        code: "{{ report.c_code }}",
        date: "{{ report.created_at }}",
        dur: "{{ report.duration }}",
        sec: "{{ report.section }}"
    };

    function downloadReport() {
        let csv = "Yarmouk University - Focus Monitoring Report\n";
        csv += "-------------------------------------------\n";
        csv += `Course: ${reportData.name} (${reportData.code})\n`;
        csv += `Date: ${reportData.date}\n`;
        csv += `Average Focus: ${reportData.avg}%\n`;
        csv += `Section: ${reportData.sec} | Duration: ${reportData.dur}\n\n`;
        csv += "Student ID,Student Name,Focus Percentage\n";
        
        const studentElements = document.querySelectorAll('.student');
        studentElements.forEach((el, index) => {
            const name = el.querySelector('.meta div div').innerText;
            const focus = el.querySelector('.badge').innerText.replace('%', '');
            csv += `${index + 1},${name},${focus}%\n`;
        });

        const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `YU_Report_${reportData.code}_${reportData.date.split(' ')[0]}.csv`;
        a.click();
    }
</script>
</body>
</html>